<!DOCTYPE html>
<html>
<head>
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö API /ask</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin-bottom: 30px; border: 1px solid #ccc; padding: 15px; }
        .card-preview { display: inline-block; margin: 5px; text-align: center; }
        .card-preview img { width: 100px; height: auto; }
        .json-output { background: #f5f5f5; padding: 10px; font-family: monospace; white-space: pre-wrap; }
        button { padding: 10px 20px; margin: 10px 0; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>üîÆ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API /ask ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏û‡πà</h1>
    
    <div class="test-section">
        <h2>‡∏ó‡∏î‡∏™‡∏≠‡∏ö API /ask</h2>
        <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏ï‡πâ‡∏≠‡∏á login ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</p>
        <input type="text" id="question" placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢" style="width: 400px; padding: 8px;" value="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á">
        <br>
        <button onclick="testAskAPI()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</button>
        <div id="ask-status"></div>
    </div>

    <div class="test-section">
        <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</h2>
        <div id="cards-info"></div>
    </div>

    <div class="test-section">
        <h2>‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏û‡πà</h2>
        <div id="cards-display"></div>
    </div>

    <div class="test-section">
        <h2>Raw API Response</h2>
        <div id="raw-response" class="json-output"></div>
    </div>

    <script>
        async function testAskAPI() {
            const questionEl = document.getElementById('question');
            const statusEl = document.getElementById('ask-status');
            const cardsInfoEl = document.getElementById('cards-info');
            const cardsDisplayEl = document.getElementById('cards-display');
            const rawResponseEl = document.getElementById('raw-response');

            if (!questionEl.value.trim()) {
                statusEl.innerHTML = '<span class="error">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</span>';
                return;
            }

            statusEl.innerHTML = '<span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢...</span>';

            try {
                const response = await fetch('/api/readings/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: questionEl.value.trim(),
                        language: 'th'
                    })
                });

                const data = await response.json();
                
                // ‡πÅ‡∏™‡∏î‡∏á raw response
                rawResponseEl.textContent = JSON.stringify(data, null, 2);

                if (!response.ok) {
                    throw new Error(data.message || `API Error: ${response.status}`);
                }

                if (!data.success) {
                    throw new Error(data.message || 'API returned success: false');
                }

                const readingData = data.data;
                statusEl.innerHTML = '<span class="success">‚úÖ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>';

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏û‡πà
                if (readingData.cards && Array.isArray(readingData.cards)) {
                    cardsInfoEl.innerHTML = \`
                        <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏û‡πà: \${readingData.cards.length} ‡πÉ‡∏ö</h3>
                        <ul>
                        \${readingData.cards.map((card, index) => \`
                            <li>
                                <strong>‡πÑ‡∏û‡πà #\${index + 1}:</strong> 
                                \${card.displayName || card.name || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠'}<br>
                                <strong>ID:</strong> \${card.id || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}<br>
                                <strong>ImageURL:</strong> \${card.imageUrl ? '‡∏°‡∏µ' : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ'}<br>
                                \${card.imageUrl ? \`<span style="font-size: 11px; color: #666;">\${card.imageUrl}</span>\` : ''}
                            </li>
                        \`).join('')}
                        </ul>
                    \`;

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏û‡πà
                    cardsDisplayEl.innerHTML = readingData.cards.map((card, index) => \`
                        <div class="card-preview">
                            <div style="border: 1px solid #ddd; padding: 5px;">
                                \${card.imageUrl ? \`
                                    <img src="\${card.imageUrl}" 
                                         alt="\${card.displayName || card.name}" 
                                         onload="console.log('‚úÖ Card \${index + 1} loaded:', '\${card.imageUrl}')"
                                         onerror="console.error('‚ùå Card \${index + 1} failed:', '\${card.imageUrl}'); this.style.border='2px solid red';"
                                         style="border: 1px solid #ccc;">
                                \` : \`
                                    <div style="width: 100px; height: 150px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border: 2px solid red;">
                                        ‚ùå No Image
                                    </div>
                                \`}
                                <div style="font-size: 12px; margin-top: 5px;">
                                    \${card.displayName || card.name || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠'}
                                </div>
                            </div>
                        </div>
                    \`).join('');
                } else {
                    cardsInfoEl.innerHTML = '<span class="error">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏û‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</span>';
                }

            } catch (error) {
                console.error('API Test Error:', error);
                statusEl.innerHTML = \`<span class="error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: \${error.message}</span>\`;
                cardsInfoEl.innerHTML = '';
                cardsDisplayEl.innerHTML = '';
                rawResponseEl.textContent = error.message;
            }
        }

        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ (‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
        // testAskAPI();
    </script>
</body>
</html>
